# Guide Agent 意图识别机制深度解析

我将为您深入解析 Guide Agent 是如何实现"智能任务回溯" (Intent Recognition) 的，特别是如何识别用户是想"继续当前任务" (CONTINUE) 还是"修改之前的任务" (BACKTRACK)。

## 核心机制：LLM 驱动的语义分类

Guide Agent 并没有使用传统的关键词匹配（正则），而是利用 LLM 的语义理解能力，通过精心设计的 System Prompt 来实现意图分类。

### 1. Prompt 设计 (Instruction)
- **意图定义**：在 Prompt 中明确定义了什么是 `CONTINUE`，什么是 `BACKTRACK`。
- **信号词示例**：给 LLM 提供了具体的信号词（如"刚才"、"之前"、"那个xx不对"）。
- **Schema 约束**：强制 LLM 输出 `intent` 和 `target_section` 字段。

### 2. 代码实现 (Implementation)
- **输入**：用户的自然语言输入。
- **处理**：`GuideAgent.step()` 方法调用 LLM。
- **输出解析**：解析 JSON 响应中的 `intent` 字段。
- **状态响应**：根据 intent 决定是继续对话还是触发状态回退。

## 解析路径
我将分三步带您看透这个机制：
1.  **Prompt 里的"教导"**：看 Prompt 是怎么教 LLM 识别意图的。
2.  **Schema 里的"约束"**：看 JSON 结构是怎么强制 LLM 输出意图的。
3.  **代码里的"执行"**：看 Python 代码拿到意图后做了什么。

## 交付形式
- **关键代码高亮**: 直接展示 `guide_agent.py` 中的相关 Prompt 片段。
- **意图识别流程图**: 直观展示从用户输入到意图判断的逻辑链路。
- **案例模拟**: 用几个具体的用户输入例子，模拟 LLM 的判断过程。
