**定向改动**

* 日志输出：在解析失败时输出一条简洁告警，包含原始 `arguments` 片段，便于排查（对应文档 L21）。

* 提示引导：当工具层返回“参数校验失败”时，除追加该 `tool_msg` 外，再追加一条短提示，明确要求 LLM 按提供的工具 Schema 重构 `arguments` 并重试（对应文档 L19-L21）。

**具体实现**

* 新增 `_parse_tool_args(raw)`：

  * `dict/list` 原样返回；

  * `str` 先 `json.loads`，失败再 `ast.literal_eval`；

  * 均失败返回 `{"__raw__": raw}`，并 `logger.warning("无法解析工具参数: %r", raw)`。

* 替换解析点：

  * `backend/editor_agent.py:130` → `arguments = self._parse_tool_args(tc.function.arguments)`；

  * `backend/editor_agent.py:150` → `arguments = self._parse_tool_args(tool_call.function.arguments)`。

* 自纠重试与提示：在两处工具执行后，若 `tool_msg['content']` 包含“参数校验失败”：

  * 先 `self.messages.append(tool_msg)`；

  * 再追加：`{"role":"assistant","content":"请严格对照上文提供的工具 Schema 重新构造 arguments 并再次调用该工具。"}`；

  * SSE 输出一条 `type="error"` 提示；

  * 扣减一次重试额度并 `continue` 当前循环。

* 重试额度：将 `max_circle` 初始值由 `1` 调整为 `2`，以允许一次自纠重试，不影响正常路径。

**边界与解耦**

* 保持与具体 Agent/SDK 解耦，统一处理 `dict/list/string`；合法性仍交由工具的 Pydantic Schema。

* 未引入新依赖或模型，改动集中在 `backend/editor_agent.py`，逻辑清晰、变更面最小。

**验证**

* 合法 JSON：工具正常执行；

* 非严格 JSON/不完整参数：不崩溃；日志可定位；SSE 给出提示；下一轮 LLM 按 Schema 修复后成功执行；

* 独占规则保持一致：`stop/askHuman` 仍独占一轮。

