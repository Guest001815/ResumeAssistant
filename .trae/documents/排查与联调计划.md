# 故障排查与联调检查计划

## 第一部分：解决 "Failed to fetch" 错误

这个错误通常意味着前端无法连接到后端服务。我们将按以下步骤排查：

### 1. 检查后端服务状态
- **确认后端是否启动**：检查终端是否运行了 `uvicorn api:app --reload --port 8001`。
- **确认端口一致性**：
  - 前端配置 (`web/.env.development`): `VITE_API_BASE=http://localhost:8001`
  - 后端启动端口必须为 **8001**。
- **检查 CORS 配置**：
  - 确认 `backend/api.py` 中的 `allow_origins` 包含了当前前端的运行端口（通常是 `http://localhost:5173` 或 `http://localhost:5178`）。

### 2. 验证网络连通性
我们将尝试直接访问后端健康检查接口，确认服务是否响应：
- 访问：`http://localhost:8001/health`
- 预期返回：`{"status": "healthy", ...}`

### 3. 检查 PDF 解析依赖
虽然 "Failed to fetch" 通常是网络问题，但我们也需要确保后端解析逻辑无误：
- 确认 `backend/parse_resume.py` 中的 API Key 是否有效。
- 确认 `PyMuPDF` (fitz) 是否正确安装。

---

## 第二部分：前后端联调全面检查计划

在修复连接问题后，我们将执行以下检查以确保功能完整：

### 1. 核心流程验证 (Happy Path)
- [ ] **简历上传**：上传 PDF，确认解析进度条正常显示，且最终能解析出 JSON 数据。
- [ ] **会话创建**：确认上传后自动创建会话，并生成优化计划。
- [ ] **Guide Agent 交互**：
  - 在聊天框输入回复，确认 Guide Agent 能理解并推进任务。
  - 确认生成的 "草稿预览" 能正确显示。
- [ ] **Editor Agent 执行**：
  - 点击 "确认修改"，确认 Editor Agent 开始执行并实时流式输出日志。
  - 确认右侧简历预览实时更新。
- [ ] **简历导出**：点击导出按钮，确认能生成 PDF/Markdown。

### 2. 边界条件测试
- [ ] **无效文件**：上传非 PDF 文件，确认有清晰的错误提示。
- [ ] **中断测试**：在解析或生成过程中点击 "取消"，确认请求被中止且界面状态重置。
- [ ] **网络异常**：模拟网络延迟或断开，确认前端有重试机制或错误提示。
- [ ] **并发测试**：快速连续发送消息，确认消息队列处理正常。

### 3. 数据持久化检查
- [ ] **刷新页面**：刷新后能否恢复之前的会话状态（通过 `sessionManager`）。
- [ ] **历史记录**：检查 "历史简历" 列表是否正确显示之前的上传记录。

我们将从第一部分开始，首先解决当前的上传失败问题。