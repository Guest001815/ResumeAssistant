# PDF 分页优化测试指南

## 修复内容

本次修复解决了 PDF 导出时内容被截断的问题：

### 主要改进

1. **智能分页**：从 `html2canvas + jsPDF` 切换到 `html2pdf.js`
   - 原方案：将简历作为一张大图片机械切割，导致章节被强制拆分
   - 新方案：使用 CSS page-break 属性，智能识别章节边界

2. **底部留白**：设置底部边距 25mm（约1英寸）
   - 避免内容填满整个页面
   - 更美观、专业的视觉效果

3. **章节完整性**：通过 CSS 属性确保内容不被拆分
   - `.section`：整个章节（如"项目经验"）保持完整
   - `.item`：单个项目不会被拆分到两页
   - `.header`：页眉始终保持完整

## 测试步骤

### 准备工作

1. 确保后端和前端都在运行：
   - 后端：http://127.0.0.1:8001
   - 前端：http://localhost:5179

2. 刷新浏览器页面以确保加载最新代码

### 测试场景 1：多项目简历（重点测试）

**目标**：验证项目经验章节不会被拆分

1. 访问 http://localhost:5179
2. 创建或打开一份包含多个项目经验的简历
3. 点击右上角的"导出" → "PDF"
4. 下载并打开 PDF 文件

**验证点**：
- ✅ "项目经验"章节是否完整地出现在一页上（或整体挪到下一页）
- ✅ 单个项目是否完整，不会被截断到两页
- ✅ 每页底部是否有明显的留白（约 25mm）
- ✅ 内容是否没有填满整个页面

### 测试场景 2：长内容简历

**目标**：验证多页分页效果

1. 创建或打开一份内容较多的简历（预计2-3页）
2. 导出为 PDF

**验证点**：
- ✅ 分页位置是否合理（在章节之间分页，而非章节内部）
- ✅ 每页底部是否都有留白
- ✅ 标题不会单独出现在页面底部（与内容分离）

### 测试场景 3：查看用户提供的示例 PDF

**参考文件**：`file:///C:/Users/admin/Downloads/resume%20(7).pdf`

1. 打开用户提供的 PDF
2. 识别哪些章节被截断
3. 用同样的简历内容重新导出
4. 对比新旧 PDF 的分页效果

**验证点**：
- ✅ 之前被截断的章节现在是否保持完整
- ✅ 底部留白是否符合预期

## 控制台日志检查

导出 PDF 时，浏览器控制台应显示：

```
开始导出 PDF...
使用 html 参数创建隐藏 iframe
成功从隐藏 iframe 提取简历内容
等待DOM完全就绪...
开始渲染 PDF（使用 html2pdf.js）...
PDF 配置: {margin: Array(4), pagebreak: {...}, format: "a4"}
PDF 导出成功！
清理临时 iframe
```

**注意**：应该看到 "使用 html2pdf.js" 而不是 "使用 html2canvas 渲染元素"

## 预期结果

### 成功标准

- ✅ 章节（特别是"项目经验"）不会被拆分到两页
- ✅ 每页底部有约 25mm 的留白空间
- ✅ 分页位置智能、合理
- ✅ 样式与页面预览一致
- ✅ 整体布局更美观、专业

### 可能的边界情况

1. **超长单个项目**：如果单个项目内容超过一页，可能会被分页
   - 这是正常的，因为无法避免
   - 但章节标题会与项目保持在同一页

2. **紧凑型章节**（技能、荣誉）：这些通常很短，应该完整保留在一页

## 技术细节

### 关键配置（export.ts）

```typescript
const opt = {
  margin: [10, 10, 25, 10] as [number, number, number, number], // 底部 25mm
  pagebreak: { 
    mode: ['avoid-all', 'css', 'legacy'],
    avoid: ['.section', '.item', '.header'] // 避免在这些元素内分页
  }
};
```

### CSS 增强（renderResume.ts）

```css
.header { page-break-inside: avoid; break-inside: avoid; }
.section { page-break-inside: avoid; break-inside: avoid; page-break-before: auto; }
.section-title { page-break-after: avoid; break-after: avoid; }
.item { page-break-inside: avoid; break-inside: avoid; }
```

## 故障排除

### 如果章节仍然被拆分

1. 检查控制台是否显示 "使用 html2pdf.js"
2. 清除浏览器缓存并刷新
3. 检查 Vite 是否成功热更新了代码

### 如果底部没有留白

1. 检查 margin 配置是否正确：`[10, 10, 25, 10]`
2. 确认导出的是最新版本的代码

### 如果导出失败

1. 检查控制台错误信息
2. 确认 html2pdf.js 库已正确导入
3. 尝试刷新页面重新导出

## 反馈

测试完成后，请记录：

1. 哪些场景通过了测试 ✅
2. 是否还有章节被截断的情况 ❌
3. 底部留白是否合适（太多/太少/刚好）
4. 其他建议或问题

---

**修改文件**：
- `web/src/utils/export.ts` - PDF 导出逻辑
- `web/src/utils/renderResume.ts` - CSS 分页属性

**测试日期**：2026-01-02

