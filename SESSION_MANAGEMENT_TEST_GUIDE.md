# 会话管理系统测试指南

## 概述

本文档提供无登录会话管理系统的测试步骤和验证清单。

## 功能概述

- ✅ 多会话管理（简历 + 职位描述 + 对话记录）
- ✅ 混合存储（LocalStorage + 服务器磁盘）
- ✅ 抽屉式UI，图标化设计
- ✅ 自动命名（从简历和JD提取）
- ✅ 会话切换、删除、重命名
- ✅ 自动保存机制

---

## 启动步骤

### 1. 启动后端

```bash
cd backend
python api.py
```

确认后端启动在 `http://localhost:8001`

### 2. 启动前端

```bash
cd web
npm run dev
```

确认前端启动在 `http://localhost:5173`

---

## 测试场景

### 场景1：创建第一个会话

**步骤**:
1. 打开浏览器访问 `http://localhost:5173`
2. 上传简历PDF（或输入简历文本）
3. 输入职位描述（JD），例如：
   ```
   字节跳动 - 前端开发工程师
   
   职位要求：
   - 熟练掌握 React、Vue 等前端框架
   - 具备良好的编程习惯和代码质量意识
   ...
   ```
4. 点击"开始优化"

**预期结果**:
- 成功进入工作区
- 后端自动提取"字节跳动"和"前端开发工程师"
- 会话名称自动生成（如："张三 - 前端开发工程师 - 字节跳动"）
- 开始生成优化计划

**验证**:
- 点击左上角 `☰` 按钮，打开会话列表
- 确认会话已创建，显示正确的公司和职位

---

### 场景2：创建多个会话

**步骤**:
1. 在工作区点击 `🏠` (返回首页) 或点击抽屉中的 `+` (新建)
2. 上传另一份简历或使用相同简历
3. 输入不同的JD，例如：
   ```
   阿里巴巴 - Java后端开发
   
   职位要求：
   - 精通 Java、Spring Boot
   - 熟悉分布式系统
   ...
   ```
4. 点击"开始优化"

**预期结果**:
- 创建第二个会话
- 会话列表中显示两个会话

**验证**:
- 打开会话抽屉
- 确认显示2个会话，每个会话显示不同的公司/职位
- 当前会话标记为 ✅

---

### 场景3：切换会话

**步骤**:
1. 在任意会话的工作区，点击 `☰` 打开抽屉
2. 鼠标悬停在另一个会话上（会展开详情）
3. 点击"切换"按钮

**预期结果**:
- 抽屉自动关闭
- 工作区内容切换为该会话的数据：
  - 简历预览更新
  - 对话历史更新
  - 任务列表更新

**验证**:
- 确认简历内容正确
- 确认对话历史是该会话的历史
- 确认任务进度正确

---

### 场景4：重命名会话

**步骤**:
1. 打开会话抽屉
2. 悬停在某个会话上
3. 点击 ✏️ (编辑) 图标
4. 输入新名称，如："字节 - 前端 - 已投递"
5. 按回车或点击 ✓ 确认

**预期结果**:
- 会话名称立即更新
- 刷新页面后名称保持

**验证**:
- 在抽屉中确认名称已更新
- 关闭并重新打开浏览器，确认名称持久化

---

### 场景5：删除会话

**步骤**:
1. 打开会话抽屉
2. 悬停在要删除的会话上
3. 点击 🗑️ (删除) 图标
4. 确认删除

**预期结果**:
- 会话从列表中消失
- 如果删除的是当前会话，返回首页

**验证**:
- 确认会话不在列表中
- 刷新页面，确认会话已永久删除
- 检查后端 `backend/storage/sessions/` 目录，确认会话文件夹已删除

---

### 场景6：刷新页面恢复会话

**步骤**:
1. 在某个会话的工作区进行交互（发送消息）
2. 刷新浏览器页面（F5）

**预期结果**:
- 页面重新加载后，自动恢复到之前的会话
- 对话历史保留
- 简历数据保留
- 任务进度保留

**验证**:
- 确认消息历史完整
- 确认简历预览正确
- 确认任务状态正确

---

### 场景7：自动保存

**步骤**:
1. 在工作区与AI进行多轮对话
2. 每次对话后等待1秒（防抖时间）
3. 打开浏览器开发者工具 → Application → Local Storage
4. 查看 `ra_messages_{session_id}` 键

**预期结果**:
- LocalStorage中自动保存最新消息
- 刷新页面后消息不丢失

**验证**:
- 确认LocalStorage中有消息数据
- 刷新后消息恢复

---

### 场景8：会话列表排序

**步骤**:
1. 创建3个以上会话
2. 在不同会话间切换
3. 打开会话抽屉

**预期结果**:
- 会话按更新时间倒序排列
- 最近使用的会话在最上方

**验证**:
- 确认最新修改的会话在列表顶部

---

### 场景9：移动端响应式

**步骤**:
1. 打开浏览器开发者工具
2. 切换到移动设备视图（iPhone/Android）
3. 测试会话抽屉

**预期结果**:
- 抽屉在移动端正常显示
- 可以正常切换、删除、重命名会话

---

### 场景10：离线降级

**步骤**:
1. 创建一个会话
2. 关闭后端服务器
3. 刷新页面

**预期结果**:
- 前端尝试从LocalStorage加载会话列表
- 显示缓存的会话数据（如果有）
- 操作会失败，但不会崩溃

**验证**:
- 打开控制台，确认有降级日志
- LocalStorage中的数据仍然可用

---

## 数据验证

### 后端存储结构

检查 `backend/storage/sessions/` 目录：

```
backend/storage/sessions/
  ├── {session_id_1}/
  │   ├── metadata.json        # 元数据
  │   └── workflow_state.json  # 完整状态
  ├── {session_id_2}/
  └── ...
```

**metadata.json 示例**:
```json
{
  "id": "abc-123-def",
  "name": "张三 - 前端开发工程师 - 字节跳动",
  "resume_file_name": "张三.pdf",
  "job_title": "前端开发工程师",
  "job_company": "字节跳动",
  "created_at": "2025-01-01T10:00:00",
  "updated_at": "2025-01-01T11:30:00",
  "progress": {
    "completed": 3,
    "total": 10
  },
  "status": "active"
}
```

### LocalStorage 数据

在浏览器开发者工具 → Application → Local Storage 中检查：

- `ra_sessions`: 会话列表（元数据数组）
- `ra_current_session_id`: 当前会话ID
- `ra_messages_{session_id}`: 每个会话的消息历史

---

## 已知限制和注意事项

1. **消息历史存储**：
   - 仅存储在LocalStorage，不同步到服务器
   - 清除浏览器缓存会丢失消息历史（但会话本身不丢失）

2. **自动命名准确性**：
   - 依赖简单的正则匹配
   - 如果JD格式不标准，可能提取不准确
   - 用户可以通过重命名功能修正

3. **并发访问**：
   - 同一浏览器多个标签页同时编辑可能冲突
   - 建议使用单个标签页

---

## 故障排查

### 问题1：会话创建失败

**症状**：点击"开始优化"后报错

**排查**：
1. 检查后端是否运行
2. 检查网络请求（F12 → Network）
3. 查看后端日志

### 问题2：会话列表为空

**症状**：打开抽屉后看不到会话

**排查**：
1. 检查 LocalStorage 是否有数据
2. 检查后端 API `/sessions` 是否正常
3. 查看控制台错误日志

### 问题3：切换会话无效

**症状**：点击切换后数据没有变化

**排查**：
1. 检查控制台是否有错误
2. 确认会话ID正确
3. 检查后端 `/sessions/{id}` API

---

## 性能指标

- 会话列表加载: < 100ms (本地缓存)
- 会话切换: < 500ms
- 创建新会话: < 2s（包含AI解析）
- 自动保存延迟: 1s (防抖)

---

## 测试清单

- [ ] 创建第一个会话
- [ ] 创建多个会话
- [ ] 切换会话
- [ ] 重命名会话
- [ ] 删除会话
- [ ] 刷新页面恢复
- [ ] 自动保存消息
- [ ] 会话列表排序
- [ ] 移动端响应式
- [ ] 离线降级
- [ ] 数据持久化验证
- [ ] 后端存储验证

---

## 反馈和改进

如发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 浏览器/系统版本
6. 控制台错误日志

