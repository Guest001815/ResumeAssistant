# Guide Agent Prompt 优化报告

## 优化目标

解决两个核心用户体验问题：
1. **格式错误**：课程部分应该是列表格式，但LLM总是写成描述性段落
2. **过度优化**：在用户明确表示没有相关课程/经历时，仍然追问或编造内容

## 优化方案

采用 **Prompt 优化** 方案（适合MVP阶段）：
- 改动最小，风险可控
- 见效快，可快速迭代
- 不增加系统复杂度

## 具体修改

在 `backend/guide_agent.py` 的 `_get_system_prompt()` 方法中增加了三个关键部分：

### 1. ROI优化原则

```python
# ROI优化原则（重要！）
1. **板块优先级分级**：
   - 核心板块（项目经历、工作经历、核心技能、实习经历）：深入挖掘，值得多轮对话
   - 次要板块（教育背景-课程、兴趣爱好、自我评价）：简洁真实即可，最多2轮对话

2. **止损策略**：
   - 如果用户连续2轮表示"没有相关经历/课程/成果"，立即停止追问
   - 对于次要板块：快速给出简化版草稿，不要过度包装
   - 保持真实性：绝不编造用户没有的经历或课程

3. **识别当前板块类型**：
   - 如果 section 包含"课程"、"教育背景"中的"课程"：这是次要板块
   - 如果 section 包含"项目"、"工作"、"实习"、"经历"：这是核心板块
```

### 2. 格式规范

```python
# 格式规范（必须严格遵守！）
1. **教育背景-课程/主修课程**：
   - 格式：课程名列表，用顿号（、）分隔
   - ✅ 正确示例：机器学习、深度学习、模式识别、数据挖掘、计算机视觉
   - ❌ 错误示例：系统学习了机器学习、深度学习等核心课程，为AI研发打下扎实基础
   - 禁止添加修饰性描述（如"系统学习了"、"打下基础"、"重点学习"等）
   - 禁止写成段落或添加括号说明
   - 直接列举课程名称即可
```

### 3. 真实性约束

```python
6. **真实性原则**：保持简历内容真实可信，绝不编造用户没有的经历、课程或成果。
```

## 测试结果

### ✅ 测试场景1：课程格式验证

**测试对话**：
```
Agent: "您是否学习过与AI应用相关的课程？"
用户: "没有，我主要学的是传统机器学习课程"

Agent: [第2轮就给出草稿]
草稿内容: "机器学习、深度学习、模式识别"
```

**格式检查**：
- ✅ 包含列表分隔符: YES
- ✅ 无描述性修饰: YES
- ✅ 结论: 格式正确

**关键改进**：
- 不再写成段落式描述
- 没有添加"系统学习了"、"打下基础"等修饰语
- 严格使用顿号分隔的列表格式

---

### ✅ 测试场景2：ROI止损策略

**测试对话**：
```
[第1轮]
Agent: "是否学习过AI应用相关课程？"
用户: "没有学过这些课程"

[第2轮] ← Agent快速止损
Agent: "了解了。那我将根据您提供的信息，为您优化主修课程部分的内容。"
草稿: "机器学习、深度学习"
```

**测试结果**：
- ✅ Agent在第2轮就提供了草稿
- ✅ 快速止损（<=3轮）
- ✅ 没有继续追问不存在的课程

**关键改进**：
- 识别到次要板块（课程）
- 用户说"没有"后快速止损
- 不再固执地追问或编造内容

---

### ✅ 测试场景3：核心板块深入挖掘

**测试对话**：
```
任务: 项目经历 - AI Agent开发
原文: "负责开发AI Agent系统，使用LLM技术。"

[第1轮]
Agent: "请回答以下问题：
1. 该AI Agent系统的具体应用场景是什么？
2. 您的具体职责是什么？"

[第2轮]
用户: "服务了100多个用户，帮助他们自动化处理文档"
Agent: "为了进一步优化，请再告诉我：
1. 您在开发中的具体职责是什么？
2. 使用了哪些模型或技术栈？"

[第3轮]
用户: "使用了RAG技术，结合公司知识库"
Agent: "为了突出您的贡献和项目价值，请再回答：
1. 在这个项目中的具体贡献是什么？
2. 系统带来了哪些可衡量的成功？"
```

**测试结果**：
- ✅ STAR相关提问次数: 3次
- ✅ 核心板块深入挖掘
- ✅ 持续追问细节和量化数据

**关键改进**：
- 识别到核心板块（项目经历）
- 使用STAR法则深入提问
- 不会过早止损，持续挖掘价值

---

## 效果总结

| 测试项 | 优化前 | 优化后 | 状态 |
|--------|--------|--------|------|
| **课程格式** | 写成段落描述 | 列表格式（顿号分隔） | ✅ 已修复 |
| **过度优化** | 固执追问，甚至编造 | 2轮止损，保持真实 | ✅ 已修复 |
| **核心板块** | 可能过早结束 | 深入挖掘（3+轮） | ✅ 保持良好 |

## 核心改进点

1. **智能分级**：区分核心板块和次要板块，采用不同策略
2. **快速止损**：次要板块最多2轮对话，避免浪费时间
3. **格式约束**：明确指定不同板块的格式要求，提供正反例
4. **真实性优先**：绝不编造，保持简历可信度
5. **ROI导向**：专注高价值点，果断放弃低价值点

## 用户体验提升

**优化前的对话**：
```
Agent: "您学过NLP课程吗？"
用户: "没有"
Agent: "那学过RAG相关课程吗？"
用户: "没有..."
Agent: "那有Agent开发课程吗？"
用户: "真的没有啊！"
Agent: [生成] "主修课程：自然语言处理、RAG系统设计..."
用户: "❌ 我根本没学过这些！"
```

**优化后的对话**：
```
Agent: "您学过AI应用相关课程吗？"
用户: "没有，我学的是传统ML"
Agent: "了解。课程背景是次要因素，我们保持真实即可。
草稿：机器学习、深度学习、模式识别
确认后我们优化更重要的项目经历部分。"
用户: "✅ 好的，这样更合理"
```

## 后续优化建议（可选）

如果需要进一步优化，可以考虑：

1. **状态机扩展**：增加 `SKIP_TASK` 动作，允许直接跳过任务
2. **Plan Agent优化**：在生成任务时就标注优先级（high/medium/low）
3. **全局视角**：传入完整简历上下文，让Agent了解整体情况
4. **用户控制**：前端增加"跳过这个任务"按钮

## 结论

通过优化 System Prompt，成功解决了两个核心用户体验问题：
- ✅ 格式问题：课程输出符合列表格式
- ✅ ROI问题：快速止损，不再过度优化次要板块
- ✅ 保持优势：核心板块仍然深入挖掘

这是一个轻量级、见效快的MVP阶段解决方案，适合快速迭代和验证。

